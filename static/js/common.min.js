/*! 崩坏 v1.0.0 | (c) wu */
var bh = function() {};
bh.information = function() {}, bh.information.prototype = {
    setDataApi: function(t) {
        this.dataApi = t
    },
    init: function(t, a, e, i) {
        this.tplObj = t || "", this.DataArea = a || "", this.pageIndex = e || 1, this.pageSize = i || 10, this.op()
    },
    op: function() {
        var t = this;
        if($("#J-type").find("li").length<=3){
            $(".information_tab_switch").hide()
        }
        $(".information_tab_switch").on("click", function() {
            "1" == $(this).data("state") ? ($(this).data("state", "2"), $(".information_tab").stop().animate({
                height: "3.21rem"
            }), $(this).css({
                transform: "rotate(180deg)"
            })) : ($(this).data("state", "1"), $(".information_tab").stop().animate({
                height: "1.48rem"
            }), $(this).css({
                transform: "rotate(0deg)"
            }))
        })
        $('.information_tab_0503 a').each(function(num){
            if(getQueryString('id') == num+1){
                $('.information_tab_0503 a').eq(num).find('.item-img-chosed').show();
                $('.information_tab_0503 a').eq(num).find('.item-img').hide();
                t.pageIndex = 1;
                t.type = getQueryString('id');
                t.getDataList()
            }
        })
        , $("#J-type").on("click", "li", function(a) {
            t.type = $.trim($(this).data("type")), $(this).addClass("selected").siblings().removeClass("selected"), t.pageIndex = 1, t.getDataList()
        }), $("#J-origin").on("click", "li", function(a) {
            t.origin = $.trim($(this).data("origin")), $(this).addClass("selected").siblings().removeClass("selected"), t.pageIndex = 1, t.getDataList()
        }), $("#J-sort").on("click", "li", function(a) {
            t.sort = $.trim($(this).data("sort")), $(this).addClass("selected").siblings().removeClass("selected"), t.pageIndex = 1, t.getDataList()
        }), $(".information_list").infiniteScroll({
            pageSize: t.pageSize,
            initLoad: !0,
            loadingHtml: "<strong>加载中...</strong>",
            loadListFn: function() {
                var a = $.Deferred();
                return t.getDataList(function(t) {
                    a.resolve(t.data)
                }), a.promise()
            }
        })
    },
    getDataList: function(t) {
        var a = this;
        a.reqData = {
            // type: a.type || $("#J-type").find(".selected").data("type"),
            // origin: a.origin || $("#J-origin").find(".selected").data("origin"),
            // sort: a.sort || $("#J-sort").find(".selected").data("sort"),
            // page: a.pageIndex,
            // pageSize: a.pageSize
            type: a.type || $("#J-type").find(".selected").data("type") || $(".information_tab_0503 a").eq(0).data("type"),
            origin: a.origin || $("#J-origin").find(".selected").data("origin"),
            sort: a.sort || $("#J-sort").find(".selected").data("sort"),
            page: a.pageIndex,
            pageSize: a.pageSize
        }, $.ajax({
            url: a.dataApi,
            dataType: "json",
            data: a.reqData,
            success: function(e) {
                var i = $(a.tplObj).html();
                1 !== a.pageIndex ? $(a.DataArea).append(laytpl(i).render(e.data)) : $(a.DataArea).html(laytpl(i).render(e.data)), "function" == typeof t && t(e), a.pageIndex++
            },
            error: function(e){
                $(".list-loading").html('暂无')
            }
        })
    }
}, bh.scrollList = function() {}, bh.scrollList.prototype = {
    setDataApi: function(t) {
        this.dataApi = t
    },
    init: function(t, a, e, i) {
        this.tplObj = t || "", this.DataArea = a || "", this.pageIndex = e || 1, this.pageSize = i || 10, this.op()
    },
    op: function() {
        var t = this;
        if($("#J-type").find("li").length<=3){
            $(".information_tab_switch").hide()
        }
        $(".information_tab_switch").on("click", function() {
            "1" == $(this).data("state") ? ($(this).data("state", "2"), $(".information_tab").stop().animate({
                height: "3.21rem"
            }), $(this).css({
                transform: "rotate(180deg)"
            })) : ($(this).data("state", "1"), $(".information_tab").stop().animate({
                height: "1.48rem"
            }), $(this).css({
                transform: "rotate(0deg)"
            }))
        });$("#J-type").on("click", "li", function(a) {
            t.type = $.trim($(this).data("type")), $(this).addClass("selected").siblings().removeClass("selected"), t.pageIndex = 1, t.getDataList()
        });
        $(".scroll_list").infiniteScroll({
            pageSize: t.pageSize,
            initLoad: !0,
            loadingHtml: "<strong>加载中...</strong>",
            loadListFn: function() {
                var a = $.Deferred();
                return t.getDataList(function(t) {
                    a.resolve(t.data)
                    if($("#MD_guanli").hasClass("on")){
                        $(".MD_check").show()
                    }
                }), a.promise()
            }
        })
    },
    getDataList: function(t) {
        var a = this;
        a.reqData = {
            type: a.type,
            page: a.pageIndex,
            pageSize: a.pageSize
        }, $.ajax({
            url: a.dataApi,
            dataType: "json",
            data: a.reqData,
            success: function(e) {
                var i = $(a.tplObj).html();
                1 !== a.pageIndex ? 
                $(a.DataArea).append(laytpl(i).render(e.data)) : 
                $(a.DataArea).html(laytpl(i).render(e.data)), 
                "function" == typeof t && t(e), 
                a.pageIndex++
            },
            error: function(e){
                $(".list-loading").html('暂无')
            }
        })
    }
}, bh.teamRecommen = function() {}, bh.teamRecommen.prototype = {
    setDataApi: function(t) {
        this.dataApi = t
    },
    init: function(t, a, e, i) {
        this.tplObj = t || "", this.DataArea = a || "", this.pageIndex = e || 1, this.pageSize = i || 10, this.op()
    },
    op: function() {
        var t = this;
        if($("#J-type").find("li").length<=3){
            $(".information_tab_switch").hide()
        }
        $(".information_tab_switch").on("click", function() {
            "1" == $(this).data("state") ? ($(this).data("state", "2"), $(".information_tab").stop().animate({
                height: "3.21rem"
            }), $(this).css({
                transform: "rotate(180deg)"
            })) : ($(this).data("state", "1"), $(".information_tab").stop().animate({
                height: "1.48rem"
            }), $(this).css({
                transform: "rotate(0deg)"
            }))
        });$("#J-type").on("click", "li", function(a) {
            t.type = $.trim($(this).data("type")), $(this).addClass("selected").siblings().removeClass("selected"), t.pageIndex = 1, t.getDataList()
        });
        $(".team_recommen_topbar").on("click", ".team_recommen_topbar_item", function(a) {
            t.type = $.trim($(this).data("type")),
                $(".team_recommen_topbar .team_recommen_topbar_item").find("img.nosel").removeClass("hide"),
                $(".team_recommen_topbar .team_recommen_topbar_item").find("img.sel").addClass("hide"),
                $(this).find("img.sel").removeClass("hide").siblings().addClass("hide"),
                $("#MD_guanli").removeClass("on").html("管理"),
                arrList = [],
                t.pageIndex = 1,
                t.getDataList()
        }), $(".team_recommen_list").infiniteScroll({
            pageSize: t.pageSize,
            initLoad: !0,
            loadingHtml: "<strong>加载中...</strong>",
            loadListFn: function() {
                var a = $.Deferred();
                return t.getDataList(function(t) {
                    a.resolve(t.data)
                    console.log(t)

                    if($("#MD_guanli").hasClass("on")){
                        $(".MD_check").show()
                    }

                    // $(".team_recommen_topbar").find(".team_recommen_topbar_item.selected").
                }), a.promise()
            }
        })
    },
    getDataList: function(t) {
        var a = this;
        a.reqData = {
            type: a.type || 1,
            page: a.pageIndex,
            pageSize: a.pageSize
        }, $.ajax({
            url: a.dataApi,
            dataType: "json",
            data: a.reqData,
            success: function(e) {
                var i = $(a.tplObj).html();
                1 !== a.pageIndex ? $(a.DataArea).append(laytpl(i).render(e.data)) : $(a.DataArea).html(laytpl(i).render(e.data)), "function" == typeof t && t(e), a.pageIndex++
            },
            error: function(e){
                $(".list-loading").html('暂无')
            }
        })
    }
}, bh.valkyrieList = function() {}, bh.valkyrieList.prototype = {
    setDataApi: function(t) {
        this.dataApi = t
    },
    init: function(t, a, e, i) {
        this.tplObj = t || "", this.DataArea = a || "", this.pageIndex = e || 1, this.pageSize = i || 10, this.op()
    },
    op: function() {
        var t = this;
        $(".scroll_list").infiniteScroll({
            pageSize: t.pageSize,
            initLoad: !0,
            loadingHtml: "<strong>加载中...</strong>",
            loadListFn: function() {
                var a = $.Deferred();
                return t.getDataList(function(t) {
                    a.resolve(t.data);
                    var e = "7.5rem";
                    $(".valkyrie_content_list").each(function(t, a) {
                        e = 2.25 * $(a).find("li").length + "rem", $(a).css("width", e)
                    })
                }), a.promise()
            }
        })
    },
    getDataList: function(t) {
        var a = this;
        a.reqData = {
            page: a.pageIndex,
            pageSize: a.pageSize
        }, $.ajax({
            url: a.dataApi,
            dataType: "json",
            data: a.reqData,
            success: function(e) {
                var i = $(a.tplObj).html();
                1 !== a.pageIndex ? $(a.DataArea).append(laytpl(i).render(e.data)) : $(a.DataArea).html(laytpl(i).render(e.data)), "function" == typeof t && t(e), a.pageIndex++
            },
            error: function(e){
                $(".list-loading").html('暂无')
            }
        })
    }
}, bh.valkyrie = function() {}, bh.valkyrie.prototype = {
    init: function() {
        this.op()
    },
    op: function() {
        $(".valkyrie_detail_tab").on("click", ".valkyrie_detail_tab_item", function(t) {
            $(".valkyrie_detail_tab .valkyrie_detail_tab_item").find("img.nosel").removeClass("hide"), $(".valkyrie_detail_tab .valkyrie_detail_tab_item").find("img.sel").addClass("hide"), $(this).find("img.sel").removeClass("hide").siblings().addClass("hide"), $(".valkyrie_detail_tabcon").addClass("hide"), $(".valkyrie_detail_tabcon").eq($(this).index()).removeClass("hide")
        }), $(".valkyrie_team_qldwdp_con_btn").on("click", function() {
            $(this).find("img.hide").removeClass("hide").siblings().addClass("hide"), $(this).find("img.sel").hasClass("hide") ? $(this).parent().find(".valkyrie_team_qldwdp_con_main_detail").addClass("hide") : $(this).parent().find(".valkyrie_team_qldwdp_con_main_detail").removeClass("hide")
        }), $(".valkyrie_team_zbtj_con_btn").on("click", function() {
            $(this).find("img.hide").removeClass("hide").siblings().addClass("hide"), $(this).find("img.sel").hasClass("hide") ? $(this).parent().find(".valkyrie_team_zbtj_con_main_detail").addClass("hide") : $(this).parent().find(".valkyrie_team_zbtj_con_main_detail").removeClass("hide")
        })
    }
}, bh.weapon = function() {}, bh.weapon.prototype = {
    setDataApi: function(t) {
        this.dataApi = t
    },
    init: function(t, a, e, i) {
        this.tplObj = t || "", this.DataArea = a || "", this.pageIndex = e || 1, this.pageSize = i || 10, this.op()
    },
    op: function() {
        var t = this;
        $(".weapon_detail_tab_bg").on("click", ".weapon_detail_tab_item", function(t) {
            $(".weapon_detail_tab_bg .weapon_detail_tab_item").find("img.nosel").removeClass("hide"),
                $(".weapon_detail_tab_bg .weapon_detail_tab_item").find("img.sel").addClass("hide"),
                $(this).find("img.sel").removeClass("hide").siblings().addClass("hide"),
                $(".weapon_detail_tabcon").addClass("hide"),
                $(".weapon_detail_tabcon").eq($(this).index()).removeClass("hide")
        }),
            $(".weapon_topbar").on("click", ".weapon_topbar_item", function(a) {
                t.type = $.trim($(this).data("type")), $(".weapon_topbar .weapon_topbar_item").find("img.nosel").removeClass("hide"), $(".weapon_topbar .weapon_topbar_item").find("img.sel").addClass("hide"), $(this).find("img.sel").removeClass("hide").siblings().addClass("hide"), t.pageIndex = 1, t.getDataList(), $(".weapon_search_ipt").val("")
            }), $(".weapon_search_ipt").change(function() {
            $(".weapon_topbar .weapon_topbar_item").find("img.nosel").removeClass("hide");
            $(".weapon_topbar .weapon_topbar_item").find("img.sel").addClass("hide")
            t.pageIndex = 1, t.getDataList(null, $(this).val())
        }), $(".scroll_list").infiniteScroll({
            pageSize: t.pageSize,
            initLoad: !0,
            loadingHtml: "<strong>加载中...</strong>",
            loadListFn: function() {
                var a = $.Deferred();
                return t.getDataList(function(t) {
                    a.resolve(t.data)
                }), a.promise()
            }
        })
    },
    getDataList: function(t, a) {
        var e = this;
        e.reqData = {
            page: e.pageIndex,
            pageSize: e.pageSize,
            type: e.type || 0,
            searchKey: a || ""
        }, $.ajax({
            url: e.dataApi,
            dataType: "json",
            data: e.reqData,
            success: function(a) {
                var i = $(e.tplObj).html();
                1 !== e.pageIndex ? $(e.DataArea).append(laytpl(i).render(a.data)) : $(e.DataArea).html(laytpl(i).render(a.data)), "function" == typeof t && t(a), e.pageIndex++
            },
            error: function(e){
                $(".list-loading").html('暂无')
            }
        })
    }
}, bh.stigmata = function() {}, bh.stigmata.prototype = {
    init: function() {
        this.op()
    },
    op: function() {
        var t = "7.5rem";
        $(".gettype_item_content_col").each(function(a, e) {
            t = 1.67 * $(e).find(".content_col_img").length + "rem", $(e).css("width", t)
        }), $(".stigmata_search_ipt").change(function() {})
    },
    getDataList: function(t, a) {
        var e = this;
        e.reqData = {
            searchKey: a || ""
        }, $.ajax({
            url: e.dataApi,
            dataType: "json",
            data: e.reqData,
            success: function(t) {
                var a = $(e.tplObj).html();
                $(e.DataArea).html(laytpl(a).render(t.data))
            },
            error: function(e){
                $(".list-loading").html('暂无')
            }
        })
    }
},
    bh.commentDetails = function() {}, bh.commentDetails.prototype = {
    setDataApi: function(t,m, o) {
        this.dataApi = t;
        this.method = m;
        this.openId = o;
    },
    init: function(t, a, e, i, p,f) {
        this.tplObj = t || "",
            this.DataArea = a || "",
            this.pageIndex = e || 1,
            this.pageSize = i || 10,
            this.parentId = p || '',
            this.parentType = f||0,
            this.sort     =1,
            this.op()
    },
    op: function() {
        //console.log(this)
        var t = this;
        arrList = [],
        //    t.pageIndex = 1;
            $("#sortTime").on("click", function(){
                var sort  = $(this).data("sortp");
                t.pageIndex=1;
                if(sort === 2){
                    t.sort = 2;
                    $(this).data("sortp",1);
                    $(this).addClass('on');
                    t.getDataList();
                }else{
                    t.sort = 1;
                    $(this).data("sortp",2);
                    $(this).removeClass('on');
                    t.getDataList();
                }
            })

        // t.getDataList();
        $(".MD_details_box").infiniteScroll({
            pageSize: t.pageSize,
            initLoad: !0,
            loadingHtml: "<strong>加载中...</strong>",
            loadListFn: function() {
                var a = $.Deferred();
                var tt= t;
                return t.getDataList(function(t) {
                    console.log(t.data);
                    if(tt.parentType==3)
                    {
                        if(t.data.comment!=null)
                            a.resolve([t.data.comment]);
                        else
                            a.resolve([]);
                    }
                    else
                    {
                        if(t.data.comments!=null)
                            a.resolve(t.data.comments);
                        else
                            a.resolve([]);
                    }

                }), a.promise()
            }
        });
    },
    getDataList: function(t) {
        var a = this;
        a.reqData = {
            openId: a.openId,
            parentId: a.parentId,
            parentType:a.parentType,
            begin: a.pageIndex-1,
            count: a.pageSize,
            sort : a.sort,
            _csrf:"<?= Yii::$app->request->csrfToken ?>"
        }, $.ajax({
            type: a.method,
            url: a.dataApi+"?t="+Date.now(),
            dataType: "json",
            data: a.reqData,
            success: function(e) {
                console.log(e)
                var i = $(a.tplObj).html();
                1 !== a.pageIndex ? $(a.DataArea).append(laytpl(i).render(e.data)) :
                    $(a.DataArea).html(laytpl(i).render(e.data)),
                "function" == typeof t && t(e),
                    a.pageIndex++
            },
            error: function(e){
                $(".list-loading").html('暂无')
            }
        })
    }
},bh.myNews = function() {}, bh.myNews.prototype = {
    setDataApi: function(t,m,o) {
        this.dataApi = t;
        this.method = m;
        this.openId = o;
    },
    init: function(t, a, e, i) {
        this.tplObj = t || "",
            this.DataArea = a || "",
            this.pageIndex = e || 1,
            this.pageSize = i || 10,
            this.op()
    },
    op: function() {
        var t = this;
        if(getQueryString('type')){
            t.type = getQueryString('type');
            t.pageIndex = 1;
            //t.getDataList();
            if(t.type === '1'){
                $(".news_tab .item_1").addClass("on")
            }else{
                $(".news_tab .item_2").addClass("on")
            }
        }else{
            if($(".news_tab .item_0").hasClass("on")){
                var type = $.trim($(this).data("type"));
                t.type = type;
                t.pageIndex = 1;
                //t.getDataList();
            }
        }

        $(".news_tab").on("click", ".item_0", function(a) {
            var type = $.trim($(this).data("type"));
            if(type === '2'){
                YDUI.dialog.alert('暂未开放！');
            }else{
                t.type = type;
                $(this).addClass("on").siblings().removeClass("on");
                t.pageIndex = 1;
                //t.getDataList();
            }
        });
        $(".p_comment_box").infiniteScroll({
            pageSize: t.pageSize,
            initLoad: !0,
            loadingHtml: "<strong>加载中...</strong>",
            loadListFn: function() {
                var a = $.Deferred();
                return t.getDataList(function(t) {
                    a.resolve(t.data.messages)
                }), a.promise()
            }
        });
    },
    getDataList: function(t) {
        var e = this;
        console.log(e,e.dataApi)
        e.reqData = {
            openId : e.openId,
            begin: e.pageIndex-1,
            count: e.pageSize,
            type: e.type || 0,
            _csrf:"<?= Yii::$app->request->csrfToken ?>"
        }, $.ajax({
            type: e.method,
            url: e.dataApi,
            dataType: "json",
            data: e.reqData,
            success: function(a) {
                var i = $(e.tplObj).html();
                1 !== e.pageIndex ?
                    $(e.DataArea).append(laytpl(i).render(a.data.messages)) :
                    $(e.DataArea).html(laytpl(i).render(a.data.messages)),
                "function" == typeof t && t(a), e.pageIndex++
            },
            error: function(e){
                $(".list-loading").html('暂无')
            }
        })
    }
}, $(function() {
    $(".header_menu").on("click", function() {
        $(".sidebar_wrap").fadeIn()
    }), $(".header_hide,.sidebar_mask").on("click", function() {
        $(".sidebar_wrap").fadeOut()
    });
    // 红点 获取当前用户的消息
    hotTip();
    window.setInterval(hotTip,10000000);
    function hotTip(){
        $.ajax({
            url: '/ap/user/unread',
            type: "POST",
            dataType: "json",
            data:{
                openid: $("#openId").val(),
                _csrf:"<?= Yii::$app->request->csrfToken ?>"
            },
            success: function(data){
                if(data.error === 0){
                    // 我的消息-》评论总数
                    $("#my_news_hot_comment i").html(data.data.count);
                    // 我的消息-》论坛总数
                    $("#my_news_hot_bbs i").html(data.data.count_2);
                    // 个人中信-》我的消息
                    $("#personal_hot_me").html(data.data.count);
                    // 个人中心-》我的舰队招募
                    $("#personal_hot_recruit").html(data.data.count_4);
                    // 个人中心-》我的通关队伍
                    $("#personal_hot_ranks").html(data.data.count_3);
                    // 个人中心-》我的收藏

                }else{
                    YDUI.dialog.alert(data.msg);
                }
            }
        })
    }
	var commMask = '';
		commMask += '<div class="tipbox" style="display:block">';
		commMask += '<div class="tipbox1"  style="display:block">';
		commMask += '<div class="tipfooter">';
		commMask += '<div id="tipAdel" class="item2"></div><div id="tipAsuc" class="item1"></div>';
		commMask += '</div>';
		commMask += '</div>';
		commMask += '</div>';
    // 删除
    $(".MD_details_box").on("click", ".del", function(){
        var that = $(this);
        var del = that.data("del");
        var splitvars = del.split(",");
        var delId = splitvars[1];
        var ctype = splitvars[2];
		$("body").append(commMask);
		$("body").on("click", "#tipAsuc", function(e){
			e.stopPropagation()
			$(".tipbox").remove();
			
		});
		$("body").on("click", "#tipAdel", function(e){
			e.stopPropagation()
			var data = {
				commentId: delId,
				commentType:ctype,
				parentId: $("#parentId").val(),
				openId: $("#openId").val(),
				_csrf:"<?= Yii::$app->request->csrfToken ?>"
			}
			$.ajax({
				type: "POST",
				url:'/ap/comment/del',
				dataType: "json",
				data: data,
				success:function(data){
					if(data.error === 0){
						if(ctype=='1'){

							var spanItem= that.parent().parent().parent().parent().find("div.details_func").find("span.comment").find("span");
							spanItem.html(parseInt(spanItem.html(),10)-1);
							that.parent().parent().remove();
						}
						else
						{
							that.parent().parent().parent().remove();
							$(".sort_num em").html(parseInt($(".sort_num em").html(), 10) -1);
						}


					}else{
						YDUI.dialog.alert(JSON.stringify(data.msg));
					}
				},
				error:function(err){
					YDUI.dialog.alert(JSON.stringify(err));
				},
				complete:function(XHR){
					$(".tipbox").remove();
				}
			})
		})
    });
    // 赞 +1 踩2
    $(".MD_details_box").on("click", ".zan", function(){
        var that = $(this);
        var zan = that.data("zan");
        var zanId = zan.split(",")[1];
        var typeId = zan.split(",")[2];
        var zanByMeType = zan.split(",")[3];
        if(!parseInt(zanByMeType, 10)){
            var data = {
                commentId: zanId,
                parentId: getQueryString("id"),
                zan: typeId,
                openId: $("#openId").val(),
                _csrf:"<?= Yii::$app->request->csrfToken ?>"
            }
            $.ajax({
                type: "POST",
                url:'/ap/comment/zan',
                dataType: "json",
                data: data,
                beforeSend: function(){
                    that.parent().find(".zan").css("pointer-events","none")
                },
                success:function(data){
                    if(data.error === 0){
                        if(typeId === '1'){
                            var zan_1 = that.find("span").html();

                            that.find("span").html(parseInt(zan_1, 10) + 1)
                        }else{
                            var zan_1 = that.find("span").html();

                            that.find("span").html(parseInt(zan_1, 10) + 1)
                        }
                        that.addClass("on");
                    }else{
                        YDUI.dialog.alert(JSON.stringify(data.msg));
                    }
                },
                error:function(err){
                    YDUI.dialog.alert(JSON.stringify(err));
                }
            })
        }

    });
    var pro_this= ''; // 点击上下文
    var parentType_a  =''; // 来源
    $(".editor_box_qx").on("click", function(){
        $(".editor_box").hide();
        $("#editor_box_content").val('')
    });
    $(".editor_box_tj").on("click", function(){
        var that = $(this);
        var parentId = $("#parentId").val();
        var openId = $("#openId").val();
        var parentUserId = $("#parentUserId").val();
        var contentHtml = $.trim($("#editor_box_content").val());
        if(contentHtml !== ""){
        $.ajax({
            type: "POST",
            url:'/ap/comment/add',
            dataType: "json",
            data: {
                openId: openId,
                parentId: parentId,
                parentType: parentType_a,
                content: contentHtml,
                parentUserId:parentUserId,
                _csrf:"<?= Yii::$app->request->csrfToken ?>"
            },
            success:function(data){
                $("#editor_box_content").val('');
                if(data.error === 0){
                    if(parentType_a == '3'){
                        var liHtml = '<li>';
                        liHtml += '<div class="details_tou">';
                        liHtml += '<img src="'+data.data.authorImageUrl+'" alt="头像" class="tou_img">';
                        liHtml += '<p>'+data.data.authorName+'</p>';
                        liHtml += '<span>'+data.data.tm+'</span>';
                        liHtml += '</div>';
                        liHtml += '</p>'+data.data.content+'</p>';
                        liHtml += '<div class="delbox">';
                        liHtml += '<span class="del fl" data-del="del,'+data.data.msgId+',1">删除</span>';
                        liHtml += ' </div>';
                        liHtml += '</li>';
                        pro_this.parents('div.detals_msg').find("ul").append(liHtml);
                        pro_this.find("span").html(parseInt(pro_this.find("span").html(), 10)+ 1);
                    }else{
                        var liHtml = '<li>';
                        liHtml += '<div class="details_tou">';
                        liHtml += '<img src="'+data.data.authorImageUrl+'" alt="头像" class="tou_img">';
                        liHtml += '<p>'+data.data.authorName+'</p>';
                        liHtml += '</div><div class="detals_msg">';
                        liHtml += '</p>'+data.data.content+'</p><ul></ul><div class="details_func">';
                        liHtml += '<span class="time fl">'+data.data.tm+'</span>';
                        liHtml += '<span class="del fl" data-del="del,'+data.data.commentId+',0">删除</span>';
                        liHtml += '<span class="bad zan fr" data-zan="zan,'+data.data.commentId+',2,0"><i></i><span>0</span></span>';
                        liHtml += '<span class="good zan fr" data-zan="zan,'+data.data.commentId+',1,0"><i></i><span>0</span></span>';
                        liHtml += '<span class="comment fr" data-parentType="3" data-commentid="'+data.data.commentId+'" data-authorId="'+data.data.authorId+'"><i></i><span>0</span></span>';
                        liHtml += '</div></div>';
                        liHtml += '</li>';
                        pro_this.prepend(liHtml);
                        $(".sort_num").find("em").html( parseInt($(".sort_num").find("em").html(), 10)+1)
                    }

                }else{
                    YDUI.dialog.alert(JSON.stringify(data.msg));
                }
            },
            error:function(err){
                YDUI.dialog.alert(JSON.stringify(err));
            }
        })
        $(".editor_box").hide();
        }else{
            YDUI.dialog.alert("内容不能为空");
        }
    });
    $("body").on("click", ".comment", function(e){
        var $this = $(this);
        pro_this = $(this);
        $(".editor_box").show();
        parentType_a = pro_this.data("parenttype");
        $("#parentId").val(pro_this.data("commentid"));
        $("#parentUserId").val(pro_this.data("authorid"))
        $(".editor_box textarea")[0].focus()
    });
    $(".editor_box").on("touchmove",function(e){
        e.preventDefault();
    });
    $("#publishComment").on("click", function(){
        var $this  = $(this);
        parentType_a = $this.data("parenttype");
        pro_this = $("#J-infoBox");
        $(".editor_box").show();
        $(".editor_box textarea")[0].focus();
    });
    var id = getQueryString('id');
    $("#parentId").val(id);
	// 判断字体
	$("#editor_box_content").on("keyup", function(){
		var maxChars = 300; 
		if($(this).val().length > maxChars){
			alert("您出入的字数超多限制!");
			which.value = $(this).val().substring(0,maxChars);
			return false;
		}else{
			var curr = maxChars - $(this).val().length;
			$("#sy").html(curr.toString());
			return true;
		}
	})
});

function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]);
    return null;
}